#summary One-sentence summary of this page.

= Annotation =

 * `@Join`, `@Fields` 추가
 * `@Column` 에 references 속성 추가

= 사용법 =

 # `@Table` annotation을 갖는 클래스들로 복합 클래스를 생성하고 `@Join` annotation 부여
 # `@Table` annotation 클래스에 `@Fields` annotation 이용하여 SELECT 대상 필드 지정
 # foreign key에 해당되는 필드의 `@Column` annotation에 references 속성 추가

= @Join Annotation =

`@Join(<join hint>)`와 같이 쓴다. join hint 가 없으면, `@Join` 클래스에 선언된 순서대로 INNER JOIN 구문 생성한다. 만약, 이전에 선언된 클래스를 참조하는 필드가 없으면 InvalidJoinException이 발생한다.

{{{
@Join
class GroupAndUser {
    @Fields("groupKey,groupName")
    Group group;
    GroupUser groupUser;
    @Fields("*")
    User user;
}

@Table("GROUP")
class Group {
    @Column(name="group_key",primaryKey=true)
    Long groupKey;
    @Column("group_name")
    String groupName;
}

@Table("GROUP_USER")
class GroupUser {
    @Column(name="group_key", references="Group.groupKey")
    Long groupKey;
    @Column(name="user_key", references="User.userKey")
    Long userKey;
}

@Table("USER")
class User {
    @Column(name="user_key", primaryKey=true)
    Long userKey;
    @Column("user_name")
    String useName;
}

Group group = new Group();
group.setGroupKey(1);
GroupAndUser gu = new GroupAndUser();
gu.setGroup(group);

List<GroupAndUser> list = entityManager.list(gu);
for (GroupAndUser gau : list) {
    System.out.println(gau.getUser().getUserName();
}
}}}

{{{
SELECT A.group_key group_groupKey, A.group_name group_groupName,
    C.user_key user_userKey, C.user_name user_userName
FROM GROUP A INNER JOIN GROUP_USER B ON A.group_key = B.group_key
    INNER JOIN USER C ON B.user_key = C.user_key
WHERE A.group_key = 1
}}}

http://www.mybatis.org/core/sqlmap-xml.html#Result_Maps

{{{

@Join("blog LEFT author LEFT post LEFT comment LEFT postTag LEFT tag")

@Join("blog LEFT author ON blog.authorId = author.id\
LEFT post ON blog.id = post.blogId\
LEFT comment ON post.id = comment.PostId
LEFT postTag ON postTag.postId = post.id
LEFT tag ON postTag.tagId = tag.id")

class BlogResult {
    @Fields("id,title,authorId")
    Blog blog;
    @Fields("id,username,passwod,email,bio,favouriteSection")
    Author author;
    @Fields("id,blogId,authorId,createdOn,section,subject,draft,body")
    Post post;
    @Fields("id,postId,name,comment")
    Comment comment;
    PostTag postTag;
    @Fields("id,name")
    Tag tag
}
}}}

{{{
from Blog B
       left outer join Author A on B.author_id = A.id
       left outer join Post P on B.id = P.blog_id
       left outer join Comment C on P.id = C.post_id
       left outer join Post_Tag PT on PT.post_id = P.id
       left outer join Tag T on PT.tag_id = T.id
}}}